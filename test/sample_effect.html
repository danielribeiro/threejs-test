<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ThreeJS Unit Tests - Using build/Three.js</title>
    <link rel="stylesheet" href="qunit-1.10.0.css">
</head>
<body>
<style>
    .input-canvas {
        display: none;
    }

    img {
        display: block;
    }

    input {
        width: 300px;
    }

    #content {
        position: absolute;
    }

    #fail {
        z-index: 500;
        position: absolute;
    }

    #original {
        position: absolute;
    }
</style>

<!-- add sources to test below -->

<script src="../vendor/rng.js"></script>
<script src="../vendor/three.js"></script>
<script src="../vendor/Mirror.js"></script>
<script src="../vendor/resemble.js"></script>
<script src="../vendor/ColladaLoader.js"></script>
<script src="mirror_sample.js"></script>
<script src="collada_sample.js"></script>
<script src="geometries_sample.js"></script>

<!-- add class-based unit tests below -->

Expected <input id="slider" type="range" name="points" min="0" max="10" step="0.01"> Actual

<div id="content">
    <img id="original" src="fixtures/collada.png">
    <img id="fail" src="fail.png">
</div>

<script>
    function ComparerWidget(original, fail) {
        this.original = original;
        this.fail = fail;
        this.min = 0;
        this.max = 10
        this.step = 12
        this.reanimateDelta = 3000
        this.lastInteraction = null
    }

    ComparerWidget.prototype.setupSlider = function () {
        var self = this;
        var lastInteraction = self.lastInteraction
        var v = this.min
        var inp = document.getElementById("slider")
        var failImg = document.getElementById("fail")
        var paused = false

        var animate = function (func) {
            var clock = new THREE.Clock()
            clock.getDelta()
            var animateWrapper = function () {
                var delta = clock.getDelta()
                requestAnimationFrame(animateWrapper)
                if (lastInteraction && new Date() - lastInteraction > self.reanimateDelta) {
                    paused = false
                }
                if (paused) return
                func(delta)
            }
            animateWrapper()
        }
        var setOpacity = function (v) {
            failImg.style.opacity = v / self.max
        }

        animate(function (delta) {
            v += self.step * delta
            if (v > self.max) {
                v = self.max
                self.step = -self.step
            }
            if (v < self.min) {
                v = self.min
                self.step = -self.step
            }
            inp.value = v
            setOpacity(v)
        })

        inp.addEventListener('click', function () {
            paused = true
            setOpacity(inp.value)
        })
        inp.addEventListener('change', function () {
            setOpacity(inp.value)
            lastInteraction = new Date()
        })
    }
    new ComparerWidget().setupSlider();


</script>


</body>
</html>
